@page "/usermanagement"
@using System.Data
@model StoryForce.Server.Pages.Admin.Person.User_management
@{
    ViewData["Title"] = "User Management";
    @*Layout = "~/Pages/Shared/_LayoutUserManagement.cshtml";*@
}
<style>
    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
    }

    th, td {
        padding: 5px;
        text-align: left;
    }

    .content-table {
        margin-top: 7%;
    }

    .header {
        font-size: 24px;
        border-bottom: 1px solid;
        font-weight: bold;
        margin-left: 35%;
    }
</style>
@section HeadScripts
{
    <link rel="stylesheet" type="text/css" href="~/materialize-admin/app-assets/css/pages/app-email.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
}

<div class="app-email">
    <div class="content-area content-right">
        <div class="app-wrapper">
            @*<div class="app-search">
                <i class="material-icons mr-2 search-icon">search</i>
                <input type="text" placeholder="Search User" class="app-filter">
            </div>
            <div>

            </div>*@
        </div>
    </div>
    <div class="row table-user">
        <div class="col s4"></div>
        <div class="col s8 content-table" style=" margin-top: 10%; margin-bottom: 5%;">
            <a href="/usermanagement/add" class="btn-small edit mb-1 teal lighten-2 add-person-button" style="width:8%">
                <i class="material-icons left" style="width: 0px; margin-left: -45%">add</i>
                <span style=" margin-right: -40%">Add</span>
            </a>
            <a href="/usermanagement/importuser" class="btn-small edit mb-1 teal lighten-2" style="width:19%">
                <i class="material-icons left" style="width: 0px; margin-left: -11%">add</i>
                <span style=" margin-right: 3%">Import User to Excel</span>
            </a>
            <span class="header">Table User</span>
            <table style="width:100%">
                <thead>
                    <tr style="background-color: #C0C0C0">
                        <th style="width:5%">Sort Order</th>
                        <th style="width:15%">Name</th>
                        <th style="width:15%">Email</th>
                        <th style="width:5%">ClassOfYear</th>
                        <th style="width:15%">PhoneNumber</th>
                        <th style="width:10%">Control</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var index = 1;
                    }
                    @if (Model != null)
                    {
                        foreach (var user in Model.User.OrderBy(m=>m.Id))
                        {
                            <tr>
                                <td>@index</td>
                                <td>@(!string.IsNullOrEmpty(user.Name) ? user.Name : null)</td>
                                <td>@(!string.IsNullOrEmpty(user.Email) ? user.Email : null)</td>
                                <td>@user.ClassOfYear</td>
                                <td>@(!string.IsNullOrEmpty(user.PhoneNumber) ? user.PhoneNumber : null)</td>
                                <td>
                                    <a href="/usermanagement/@user.Id">Edit</a>
                                    <a class="delete-user" data-id-people="@user.Id" href="#">Delete</a>
                                </td>
                            </tr>
                            index++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".content-table").on("click", ".delete-user", function () {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ok'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/api/people/' + $(this).data("id-people"),
                        type: 'DELETE'
                    }).then(function (res) {
                        Swal.fire(
                            'Deleted!',
                            "The people was deleted",
                            'success'
                        ).then(function () {
                            window.location.reload();
                        });

                    });

                }
            });

        });

    })
</script>